{
  "meta": {
    "author": "jptosso",
    "description": "Test if the json request body work",
    "enabled": true,
    "name": "json.yaml"
  },
  "rules": "SecRequestBodyAccess On\nSecRule REQUEST_HEADERS:content-type \"application/json\" \"id: 100, phase:1, pass, log, ctl:requestBodyProcessor=JSON\"\nSecRule REQBODY_PROCESSOR \"JSON\" \"id: 101,phase:2,log,block\"\n\nSecRule REQBODY_ERROR \"!@eq 0\" \"id:1111, phase:2, log, block\"\n\nSecRule REQUEST_BODY \"456\" \"id:103, phase:2, log\"\nSecRule ARGS:json.test \"@eq 123\" \"id:1100, phase:2, log, block\"\nSecRule ARGS:json.test3.2 \"@eq 55\" \"id:1101, phase:2, log, block\"\n\n# We test for some vulnerability\nSecRule ARGS:json.test \"@eq 456\" \"id:1102, phase:2, log, block\"\n\nSecRule ARGS:json.test3 \"@eq 3\" \"id: 1010, phase:2, log, block\"",
  "tests": [
    {
      "stages": [
        {
          "stage": {
            "input": {
              "data": "{\"test\":123, \"test2\": 456, \"test3\": [22, 44, 55]}",
              "headers": {
                "content-type": "application/json"
              },
              "method": "POST",
              "uri": "/index.php?json.test=456"
            },
            "output": {
              "non_triggered_rules": [
                1111,
                1102,
                103
              ],
              "triggered_rules": [
                100,
                101,
                1100,
                1101,
                1010
              ]
            }
          }
        }
      ],
      "test_title": "json"
    }
  ]
}
